---
title: "Sensitive Files on SMB Network Share"
CVSS: 7.6
---

| CWE                               | [CWE-200: Exposure of Sensitive Information to an Unauthorized Actor](https://cwe.mitre.org/data/definitions/200.html)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| --------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| CVSS 3.1 Score                    | [7.6](https://nvd.nist.gov/vuln-metrics/cvss/v3-calculator?vector=AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:L/A:L&version=3.1)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| Description (Incl. Root<br>Cause) | The tester discovered sensitive information on a network share. The document discovered is for the SOC Analysis team and includes a packet capture of the internal network, including multiple requests to Windows services running within the Active Directory environment. Of those, was a packet containing Kerberos Pre-Authentication information that included the pre-auth cipher, this cipher is the timestamp encrypted using a domain users password hash as the encryption key and can be 'guessed'(via password cracking) offline.                                                          |
| Security Impact                   | A tester with access to the SMB network share via an unprivileged user can potentially discover, retrieve, and analyze the packet capture using a tool such as Wireshark. The tester can then obtain the cipher field in the Kerberos pre-authentication packet and crack this offline, revealing the users plain-text password. This password may then be used to access the active directory domain as that user, including any machines, services, and network shares the user has access to.                                                                                                        |
| Affected Resource                 | (AD) office.htb                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| Remediation                       | Limit the storing of any sensitive information in file shares, this is especially important when the documents stored in the share contain credentials, even if these credentials as password hashes and not stored in plain-text.<br><br>Further, consider limiting permissions to each share, ideally with directories and files in each share further limited and only accessible by specific users when necessary for business operations. This can be done by ensuring stricter READ/WRITE permissions on each share, only allowing users to read and/or write to a share when strictly necessary. |
| External References               | https://attack.mitre.org/techniques/T1039/<br><br>https://learn.microsoft.com/en-us/windows-server/storage/file-server/smb-security                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |


Finding evidence can be seen in reports in which this finding was referenced. Finding seen in the following report(s):

[Office - HTB Labs - Active Directory Penetration Test]({{ site.baseurl }}{% link _posts/2024-09-10-Office-AD-PT.md %}#4-sensitive-files-on-smb-network-share)
